# Доступ к сетевым устройствам по протоколу SSH
### Топология
![](topology.png)
### Таблица адресации
| Устройство  | Интерфейс | IP-адрес     | Маска подсети    | Шлюз по умолчанию |
|-------------|-----------|--------------|------------------|-------------------|
| R1          | G0/0/1    | 192.168.1.1  | 255.255.255.0    |192.168.1.1        |
| S1          | VLAN1     | 192.168.1.11 | 255.255.255.0    |192.168.1.1        |
| PC-A        | NIC       | 192.168.1.3  | 255.255.255.0    |192.168.1.1        |
### Задачи:
 1. Настройка основных параметров устройства
 2. Настройка маршрутизатора для доступа по протоколу SSH
 3. Настройка коммутатора для доступа по протоколу SSH
 4. SSH через интерфейс командной строки (CLI) коммутатора
### 1. Настройка основных параметров устройства
В части 1 настраиваем топологию сети и основные параметры, такие как IP адреса интерфейсов, доступ к устройствам и пароли на маршрутизаторе.
#### Шаг 1. Создаем сеть согласно топологии
#### Шаг 2. Выполняем инициализацию маршрутизатора и коммутатора
#### Шаг 3. Настраиваем маршрутизатора
Подключаемся к маршрутизатору с помощью консоли.    
Входим в привилегированный режим.    
Входим в режим глобальной конфигурации.   
Задаем имя маршрутизатору.   
```
enable
configure terminal
hostname R1
```
Отключаем интерпретацию команды как DNS имя - на случай ввода команды с ошибкой.    
Включаем шифрование паролей.   
Устанавливаем пароль для доступа к коммутатору через консольный кабель и включаем доступ к пользовательскому режиму.   
Устанавливаем локальный пароль доступа в привилегированный режим консоли.   
Устанавливаем пароль VTY и включаем вход в систему по паролю.    
Задаем баннерное сообщение при входе в систему.
```
no ip domain-lookup
service password-encryption
line console 0
password cisco
login
enable secret class
line vty 0 4
password cisco
login
banner motd @--- Unauthorized access is strictly prohibited ---@
```
Настраиваем на маршрутизаторе интерфейс G0/0/1 согласно таблице адресации.   
```
interface g0/0/1
ip address 192.168.1.1 255.255.255.0
no shutdown 
```
Сохраняем текущую конфигурацию в файл загрузочной конфигурации.
```
R1#copy running-config startup-config
Destination filename [startup-config]? 
Building configuration...
[OK]
```
#### Шаг 4. Настраиваем компьютер PC-A
Настраиваем для компьютера IP-адрес, маску подсети и шлюз по умолчанию согласно таблице адресации.   
#### Шаг 5. Проверяем подключение к сети
Открытваем на компьютере PC-A командную строку и отправляем эхо-запрос на на маршрутизатор R1 с помощью команды ***ping***. 
```
Reply from 192.168.1.1: bytes=32 time=1ms TTL=255
```
Убеждаемся, что эхо-запрос проходит успешно.
### 2. Настройка маршрутизатора для доступа по протоколу SSH
#### Шаг 1. Настраиваем аутентификацию устройств
Задаем домен для генерации ключа шифрования. Имя устройства было задано выше.  
```
ip domain-name otus.ru
```
#### Шаг 2. Создаем ключ шифрования с указанием его длины
Генерируем ключ шифрования, задаем размер ключа 2048 бит.    
```
crypto key generate rsa
```
#### Шаг 3. Создаем имя пользователя в локальной базе учетных записей
Создаем учетную запись администратора.
```
username admin secret Adm1nP@55
```
#### Шаг 4. Активируем протокол SSH на линиях VTY
Настраиваем SSH версии 2.    
Активируем протоколы Telnet и SSH на входящих линиях VTY.
Изменяем способ входа в систему таким образом, чтобы использовалась проверка пользователей по локальной базе учетных записей.   
```
ip ssh version 2
line vty 0 4
transport input ssh
login local
```
#### Шаг 5. Сохраняем текущую конфигурацию в файл загрузочной конфигурации
Сохраняем текущую конфигурацию в файл загрузочной конфигурации, используя команду ***copy running-config startup-config***
#### Шаг 6. Устанавливаем соединение с маршрутизатором по протоколу SSH
Запускаем Telnet/SSH клиент на PC-A.        
Устанавливаем SSH-подключение к R1, используя логин admin и пароль Adm1nP@55.   
### 3. Настройка коммутатора для доступа по протоколу SSH
#### Шаг 1. Настраиваем основные параметры коммутатора
Входим в привилегированный режим.    
Входим в режим глобальной конфигурации.   
Отключаем интерпретацию команды как DNS имя - на случай ввода команды с ошибкой.   
Задаем имя коммутатора.   
Включаем шифрование паролей.   
Устанавливаем пароль для доступа к коммутатору через консольный кабель и включаем доступ к пользовательскому режиму.   
Устанавливаем локальный пароль доступа в привилегированный режим консоли.   
Задаем баннерное сообщение при входе в систему.
```
enable
configure terminal
no ip domain-lookup
hostname S1
service password-encryption
line console 0
password cisco
login
enable secret class
banner motd @--- Unauthorized access is strictly prohibited ---@
```
Настраиваем на коммутаторе VLAN 1 согласно таблице адресации. 
```
interface vlan 1
ip address 192.168.1.11 255.255.255.0
no shutdown 
```
Сохраняем текущую конфигурацию в файл загрузочной конфигурации, используя команду ***copy running-config startup-config***.    
Задаем домен для генерации ключа шифрования. Имя устройства было задано выше.  
```
ip domain-name otus.ru
```
Генерируем ключ шифрования, задаем размер ключа 2048 бит.    
```
crypto key generate rsa
```
Создаем учетную запись администратора.
```
username admin secret Adm1nP@55
```
Настраиваем SSH версии 2.    
Активируем протоколы Telnet и SSH на входящих линиях VTY.
Изменяем способ входа в систему таким образом, чтобы использовалась проверка пользователей по локальной базе учетных записей.   
```
ip ssh version 2
line vty 0 4
transport input ssh
login local
```
#### Шаг 3. Устанавливаем соединение с коммутатором по протоколу SSH
Запускаем Telnet/SSH клиент на PC-A.        
Устанавливаем SSH-подключение к S1, используя логин admin и пароль Adm1nP@55.   
### 4. Настройка протокола SSH с использованием интерфейса командной строки (CLI) коммутатора
#### Шаг 1. Смотрим доступные параметры для клиента SSH в Cisco IOS 
Используем вопросительный знак (**?**), чтобы отобразить варианты параметров для команды ***SSH***.
Изучаем доступные варианты.
#### Шаг 2. Устанавливаем соединение с маршрутизатором R1 по протоколу SSH с коммутатора S1
Подключаемся к маршрутизатору.
```
S1#ssh -l admin 192.168.1.1
Password: 
--- Unauthorized access is strictly prohibited ---
R1>en
Password: 
R1#
```
Чтобы вернуться к коммутатору S1,не закрывая сеанс SSH с маршрутизатором R1, нажимаем комбинацию клавиш **Ctrl+Shift+6**, затем нажимаем **x**. Отображается приглашение режима глобальной конфигурации коммутатора.
```
R1#
S1#
```
Для возвращения к сеансу SSH на R1, нажимаем клавишу Enter в пустой строке интерфейса командной строки. Чтобы увидеть окно командной строки маршрутизатора, нажимаем клавишу Enter еще раз.
```
S1#
[Resuming connection 1 to 192.168.1.1 ... ]
R1#
```
Чтобы завершить сеанс SSH намаршрутизаторе R1, вводим в командной строке маршрутизатора команду ***exit***.
```
R1#
R1#exit
[Connection to 192.168.1.1 closed by foreign host]
S1#
```
